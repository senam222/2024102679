
 } catch (error) {
 console.error('환율 변환 오류:', error);
 utils.updateStatus('⚠️ 환율 변환 실패', 'error');
 } finally {
 this.state.isConverting = false;
 }
 }

 clearOtherInputs(excludeCountry) {
 Object.keys(COUNTRIES).forEach(country => {
 if (country !== excludeCountry) {
 const input = document.querySelector(`.input-${country} input`);
 if (input) input.value = '';
 }
 });
 }

 clearAllInputs() {
 document.querySelectorAll('.currency-input input').forEach(input => {
 input.value = '';
 });
 this.state.clearActive();
 }

 async fetchExchangeRates() {
 utils.updateStatus('🔄 환율 업데이트 중...', 'loading');

 try {
 const controller = new AbortController();
 const timeoutId = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);

 const response = await fetch('https://api.exchangerate-api.com/v4/latest/KRW', {
 signal: controller.signal
 });

 clearTimeout(timeoutId);

 if (!response.ok) {
 throw new Error(`HTTP ${response.status}`);
 }

 const data = await response.json();

 if (data.rates) {
 // 환율 업데이트
 Object.keys(exchangeRates).forEach(currency => {
 if (data.rates[currency]) {
 exchangeRates[currency] = 1 / data.rates[currency];
 }
 });

 this.state.lastUpdate = new Date();
 const timeString = this.state.lastUpdate.toLocaleTimeString('ko-KR');

 utils.updateStatus(
 `✅ 환율 업데이트 완료<br><small>시간: ${timeString}</small>`,
 'success'
 );
 } else {
 throw new Error('응답 데이터 없음');
 }
 } catch (error) {
 console.error('환율 API 오류:', error);

 let message = '⚠️ 환율 업데이트 실패<br><small>기본 환율 사용</small>';
 if (error.name === 'AbortError') {
 message = '⚠️ 요청 시간 초과<br><small>기본 환율 사용</small>';
 }

 utils.updateStatus(message, 'error');
 }
 }

 startPeriodicUpdates() {
 // 주기적 환율 업데이트
 setInterval(() => {
 this.fetchExchangeRates();
 }, CONFIG.UPDATE_INTERVAL);

 // 페이지 가시성 API 사용 - 탭이 활성화될 때 업데이트
 document.addEventListener('visibilitychange', () => {
 if (!document.hidden && this.state.lastUpdate) {
 const timeSinceUpdate = Date.now() - this.state.lastUpdate.getTime();
 if (timeSinceUpdate > CONFIG.UPDATE_INTERVAL) {
 this.fetchExchangeRates();
 }
 }
 });
 }
 }

 // 앱 초기화
 document.addEventListener('DOMContentLoaded', () => {
 new CurrencyConverter();
 });

 // 전역 오류 처리
 window.addEventListener('error', (e) => {
 console.error('전역 오류:', e.error);
 utils.updateStatus('⚠️ 애플리케이션 오류 발생', 'error');
 });

 // 서비스 워커 등록 (선택사항)
 if ('serviceWorker' in navigator) {
 window.addEventListener('load', () => {
 // 향후 오프라인 지원을 위한 서비스 워커 등록 코드
 console.log('서비스 워커 지원 가능');
 });
 }
 </script>
</body>
</html>
