<!DOCTYPE html>
<html lang="ko">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>ì‹¤ì‹œê°„ í™˜ìœ¨ ë³€í™˜ ì§€ë„</title>
 <script src="https://www.gstatic.com/charts/loader.js"></script>
 <style>
 :root {
 --primary-color: #667eea;
 --secondary-color: #764ba2;
 --accent-color: #f56500;
 --success-color: #48bb78;
 --error-color: #e53e3e;
 --warning-color: #f6ad55;
 --bg-primary: #f5f5f5;
 --bg-secondary: white;
 --border-color: #e2e8f0;
 --text-primary: #2d3748;
 --text-secondary: #4a5568;
 --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
 --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
 }

 * {
 box-sizing: border-box;
 }

 body {
 font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
 margin: 0;
 padding: 20px;
 background: var(--bg-primary);
 color: var(--text-primary);
 line-height: 1.6;
 }

 .container {
 max-width: 1400px;
 margin: 0 auto;
 background: var(--bg-secondary);
 border-radius: 12px;
 box-shadow: var(--shadow-lg);
 overflow: hidden;
 }

 .header {
 background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
 color: white;
 padding: 24px;
 text-align: center;
 }

 .header h1 {
 margin: 0 0 12px 0;
 font-size: clamp(20px, 4vw, 32px);
 font-weight: 700;
 }

 .header p {
 margin: 0;
 opacity: 0.9;
 font-size: 16px;
 }

 .map-container {
 position: relative;
 padding: 20px;
 min-height: 650px;
 }

 .map-wrapper {
 position: relative;
 width: 100%;
 height: 600px;
 border-radius: 8px;
 overflow: hidden;
 }

 #geochart {
 width: 100%;
 height: 100%;
 }

 .currency-input {
 position: absolute;
 background: var(--bg-secondary);
 border: 2px solid var(--border-color);
 border-radius: 8px;
 padding: 8px;
 width: 70px;
 box-shadow: var(--shadow);
 z-index: 1000;
 transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
 cursor: pointer;
 transform: translate(-50%, -50%);
 backdrop-filter: blur(10px);
 }

 .currency-input:hover {
 transform: translate(-50%, -50%) scale(1.05);
 box-shadow: var(--shadow-lg);
 }

 .currency-input.active {
 border-color: var(--accent-color);
 box-shadow: 0 8px 25px rgba(245, 101, 0, 0.3);
 transform: translate(-50%, -50%) scale(1.1);
 background: #fff7ed;
 z-index: 1020;
 }

 .currency-input.target {
 border-color: var(--success-color);
 box-shadow: 0 4px 15px rgba(72, 187, 120, 0.2);
 background: #f0fff4;
 transform: translate(-50%, -50%) scale(1.02);
 }

 .currency-input.map-hover {
 border-color: var(--primary-color);
 box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
 transform: translate(-50%, -50%) scale(1.15);
 background: #eef2ff;
 z-index: 1010;
 }

 .country-label {
 font-size: 9px;
 font-weight: 600;
 color: var(--primary-color);
 margin-bottom: 4px;
 text-align: center;
 line-height: 1.2;
 letter-spacing: 0.02em;
 }

 .currency-input input {
 width: 100%;
 padding: 4px 6px;
 border: 1px solid var(--border-color);
 border-radius: 4px;
 font-size: 10px;
 text-align: center;
 background: transparent;
 transition: all 0.2s ease;
 font-weight: 500;
 -moz-appearance: textfield; /* Firefox */
 }

 /* Chrome, Safari, Edge - ìŠ¤í•€ ë²„íŠ¼ ì œê±° */
 .currency-input input::-webkit-outer-spin-button,
 .currency-input input::-webkit-inner-spin-button {
 -webkit-appearance: none;
 margin: 0;
 }

 .currency-input input:focus {
 outline: none;
 border-color: var(--primary-color);
 box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
 }

 .currency-input input::placeholder {
 color: #a0aec0;
 }

 /* ë°˜ì‘í˜• ìœ„ì¹˜ ì¡°ì • */
 .input-US { left: 23%; top: 48%; }
 .input-CA { left: 21%; top: 30%; }
 .input-BR { left: 35%; top: 68%; }
 .input-GB { left: 46%; top: 30%; }
 .input-FR { left: 47%; top: 43%; } /* 5% ì•„ë˜ë¡œ (38% â†’ 43%) */
 .input-DE { left: 54%; top: 34%; } /* 4% ì˜¤ë¥¸ìª½ìœ¼ë¡œ (50% â†’ 54%) */
 .input-RU { left: 65%; top: 22%; }
 .input-CN { left: 68%; top: 50%; } /* 2% ì™¼ìª½ìœ¼ë¡œ (70% â†’ 68%) */
 .input-IN { left: 62%; top: 58%; } /* 6% ì™¼ìª½ìœ¼ë¡œ (68% â†’ 62%) */
 .input-KR { left: 75%; top: 45%; }
 .input-JP { left: 82%; top: 48%; }
 .input-AU { left: 80%; top: 75%; }

 .status-panel {
 position: absolute;
 top: 20px;
 left: 20px;
 background: var(--bg-secondary);
 border: 2px solid var(--success-color);
 border-radius: 12px;
 padding: 16px;
 box-shadow: var(--shadow-lg);
 z-index: 1001;
 min-width: 220px;
 backdrop-filter: blur(10px);
 }

 .status-panel h4 {
 margin: 0 0 12px 0;
 color: var(--success-color);
 font-size: 14px;
 font-weight: 600;
 }

 .api-status {
 font-size: 11px;
 color: var(--text-secondary);
 margin-top: 10px;
 padding: 8px;
 background: #f8f9fa;
 border-radius: 6px;
 border-left: 3px solid var(--border-color);
 transition: all 0.3s ease;
 }

 .loading {
 color: var(--warning-color);
 border-left-color: var(--warning-color);
 }
 .success {
 color: var(--success-color);
 border-left-color: var(--success-color);
 }
 .error {
 color: var(--error-color);
 border-left-color: var(--error-color);
 }

 .instruction {
 margin-top: 20px;
 padding: 16px 20px;
 background: linear-gradient(45deg, #e8f2ff, #f0f8ff);
 border-radius: 8px;
 text-align: center;
 color: var(--text-primary);
 border: 1px solid rgba(102, 126, 234, 0.1);
 }

 .loading-overlay {
 position: absolute;
 top: 0;
 left: 0;
 right: 0;
 bottom: 0;
 background: rgba(255, 255, 255, 0.9);
 display: flex;
 align-items: center;
 justify-content: center;
 z-index: 2000;
 backdrop-filter: blur(4px);
 opacity: 0;
 visibility: hidden;
 transition: all 0.3s ease;
 }

 .loading-overlay.show {
 opacity: 1;
 visibility: visible;
 }

 .spinner {
 width: 40px;
 height: 40px;
 border: 4px solid #f3f3f3;
 border-top: 4px solid var(--primary-color);
 border-radius: 50%;
 animation: spin 1s linear infinite;
 }

 @keyframes spin {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
 }

 /* ë°˜ì‘í˜• ë””ìì¸ */
 @media (max-width: 768px) {
 body {
 padding: 10px;
 }

 .header {
 padding: 16px;
 }

 .map-container {
 padding: 15px;
 min-height: 500px;
 }

 .map-wrapper {
 height: 450px;
 }

 .currency-input {
 width: 60px;
 padding: 6px;
 }

 .country-label {
 font-size: 8px;
 }

 .currency-input input {
 font-size: 9px;
 }

 .status-panel {
 position: relative;
 top: auto;
 left: auto;
 margin-bottom: 15px;
 min-width: auto;
 }
 }

 /* ë‹¤í¬ëª¨ë“œ ì§€ì› */
 @media (prefers-color-scheme: dark) {
 :root {
 --bg-primary: #1a202c;
 --bg-secondary: #2d3748;
 --text-primary: #f7fafc;
 --text-secondary: #e2e8f0;
 --border-color: #4a5568;
 }
 }
 </style>
</head>
<body>
 <div class="container">
 <div class="header">
 <h1>ğŸŒ ì‹¤ì‹œê°„ ë‹¤êµ­ê°€ í™˜ìœ¨ ë³€í™˜</h1>
 <p>í•œ êµ­ê°€ì— ê¸ˆì•¡ì„ ì…ë ¥í•˜ë©´ ëª¨ë“  êµ­ê°€ì˜ í™˜ìœ¨ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤</p>
 </div>

 <div class="map-container">
 <div class="loading-overlay" id="loadingOverlay">
 <div class="spinner"></div>
 </div>

 <div class="map-wrapper">
 <div id="geochart"></div>

 <!-- êµ­ê°€ë³„ í†µí™” ì…ë ¥ í•„ë“œ -->
 <div class="currency-input input-US" data-country="US" data-currency="USD">
 <div class="country-label">ë¯¸êµ­ (USD)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-CA" data-country="CA" data-currency="CAD">
 <div class="country-label">ìºë‚˜ë‹¤ (CAD)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-BR" data-country="BR" data-currency="BRL">
 <div class="country-label">ë¸Œë¼ì§ˆ (BRL)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-GB" data-country="GB" data-currency="GBP">
 <div class="country-label">ì˜êµ­ (GBP)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-FR" data-country="FR" data-currency="EUR">
 <div class="country-label">í”„ë‘ìŠ¤ (EUR)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-DE" data-country="DE" data-currency="EUR">
 <div class="country-label">ë…ì¼ (EUR)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-RU" data-country="RU" data-currency="RUB">
 <div class="country-label">ëŸ¬ì‹œì•„ (RUB)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-CN" data-country="CN" data-currency="CNY">
 <div class="country-label">ì¤‘êµ­ (CNY)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-IN" data-country="IN" data-currency="INR">
 <div class="country-label">ì¸ë„ (INR)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>

 <div class="currency-input input-KR" data-country="KR" data-currency="KRW">
 <div class="country-label">í•œêµ­ (KRW)</div>
 <input type="number" placeholder="0" step="1" min="0">
 </div>

 <div class="currency-input input-JP" data-country="JP" data-currency="JPY">
 <div class="country-label">ì¼ë³¸ (JPY)</div>
 <input type="number" placeholder="0" step="1" min="0">
 </div>

 <div class="currency-input input-AU" data-country="AU" data-currency="AUD">
 <div class="country-label">í˜¸ì£¼ (AUD)</div>
 <input type="number" placeholder="0" step="0.01" min="0">
 </div>
 </div>

 <div class="status-panel">
 <h4>ğŸ’¡ ì‚¬ìš©ë²•</h4>
 <div style="font-size: 12px; line-height: 1.5; color: var(--text-secondary);">
 í…ìŠ¤íŠ¸ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ê³ <br>
 ê¸ˆì•¡ì„ ì…ë ¥í•´ë³´ì„¸ìš”!
 </div>
 <div class="api-status" id="apiStatus">
 ğŸ”„ ì‹¤ì‹œê°„ í™˜ìœ¨ ë¡œë”© ì¤‘...
 </div>
 </div>

 <div class="instruction">
 <strong>ğŸ’° ì‹¤ì‹œê°„ í™˜ìœ¨ ë³€í™˜:</strong>
 í•œ êµ­ê°€ì— ê¸ˆì•¡ì„ ì…ë ¥í•˜ë©´ ë‹¤ë¥¸ ëª¨ë“  êµ­ê°€ì— ìë™ìœ¼ë¡œ í™˜ì „ëœ ê¸ˆì•¡ì´ í‘œì‹œë©ë‹ˆë‹¤
 <br><small style="color: var(--text-secondary); margin-top: 8px; display: block;">
 ğŸ”„ í™˜ìœ¨ì€ 5ë¶„ë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤ | ğŸ“± ë°˜ì‘í˜• ë””ìì¸ ì§€ì›
 </small>
 </div>
 </div>
 </div>

 <script>
 // ìƒìˆ˜ ë° ì„¤ì •
 const CONFIG = {
 UPDATE_INTERVAL: 5 * 60 * 1000, // 5ë¶„
 DEBOUNCE_DELAY: 300, // ì…ë ¥ ë””ë°”ìš´ì‹±
 API_TIMEOUT: 10000, // API íƒ€ì„ì•„ì›ƒ
 DECIMAL_PLACES: {
 JPY: 0, KRW: 0,
 INR: 1, RUB: 1,
 default: 2
 }
 };

 // êµ­ê°€-í†µí™” ë§¤í•‘
 const COUNTRIES = {
 US: { currency: 'USD', name: 'ë¯¸êµ­' },
 CA: { currency: 'CAD', name: 'ìºë‚˜ë‹¤' },
 BR: { currency: 'BRL', name: 'ë¸Œë¼ì§ˆ' },
 GB: { currency: 'GBP', name: 'ì˜êµ­' },
 FR: { currency: 'EUR', name: 'í”„ë‘ìŠ¤' },
 DE: { currency: 'EUR', name: 'ë…ì¼' },
 RU: { currency: 'RUB', name: 'ëŸ¬ì‹œì•„' },
 CN: { currency: 'CNY', name: 'ì¤‘êµ­' },
 IN: { currency: 'INR', name: 'ì¸ë„' },
 KR: { currency: 'KRW', name: 'í•œêµ­' },
 JP: { currency: 'JPY', name: 'ì¼ë³¸' },
 AU: { currency: 'AUD', name: 'í˜¸ì£¼' }
 };

 // ê¸°ë³¸ í™˜ìœ¨ (KRW ê¸°ì¤€)
 let exchangeRates = {
 USD: 1330, CAD: 980, BRL: 270, GBP: 1680, EUR: 1450,
 RUB: 14, CNY: 185, INR: 16, KRW: 1, JPY: 9.8, AUD: 890
 };

 const CHART_COLORS = [
 '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4',
 '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD',
 '#00D2D3', '#FF9F43', '#10AC84', '#EE5A24'
 ];

 // ìƒíƒœ ê´€ë¦¬
 class AppState {
 constructor() {
 this.activeCountry = null;
 this.isConverting = false;
 this.lastUpdate = null;
 this.chart = null;
 }

 setActive(country) {
 this.activeCountry = country;
 this.updateUI();
 }

 clearActive() {
 this.activeCountry = null;
 this.updateUI();
 }

 updateUI() {
 // ëª¨ë“  ìƒíƒœ í´ë˜ìŠ¤ ì œê±°
 document.querySelectorAll('.currency-input').forEach(el => {
 el.classList.remove('active', 'target', 'map-hover');
 });

 if (this.activeCountry) {
 const activeEl = document.querySelector(`.input-${this.activeCountry}`);
 activeEl?.classList.add('active');

 // ë‹¤ë¥¸ êµ­ê°€ë“¤ì„ targetìœ¼ë¡œ ì„¤ì •
 Object.keys(COUNTRIES).forEach(country => {
 if (country !== this.activeCountry) {
 document.querySelector(`.input-${country}`)?.classList.add('target');
 }
 });
 }
 }
 }

 // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
 const utils = {
 debounce(func, wait) {
 let timeout;
 return function executedFunction(...args) {
 const later = () => {
 clearTimeout(timeout);
 func(...args);
 };
 clearTimeout(timeout);
 timeout = setTimeout(later, wait);
 };
 },

 // ìˆ«ìë¥¼ í†µí™”ë³„ í˜•ì‹ì— ë§ê²Œ í¬ë§·íŒ… - ì‰¼í‘œ ì—†ì´ ê°„ë‹¨í•˜ê²Œ
 formatCurrency(value, currency) {
 if (!value || isNaN(value) || value === 0) return '';

 const num = parseFloat(value);
 const decimals = CONFIG.DECIMAL_PLACES[currency] ?? CONFIG.DECIMAL_PLACES.default;

 return num.toFixed(decimals);
 },

 // ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
 parseNumber(str) {
 if (!str || str === '') return 0;
 const num = parseFloat(str);
 return isNaN(num) ? 0 : num;
 },

 // ì…ë ¥ê°’ì´ ìœ íš¨í•œ ìˆ«ìì¸ì§€ ê²€ì‚¬
 isValidNumber(str) {
 if (!str || str.trim() === '') return false;
 const num = this.parseNumber(str);
 return !isNaN(num) && num > 0;
 },

 showLoading() {
 document.getElementById('loadingOverlay').classList.add('show');
 },

 hideLoading() {
 document.getElementById('loadingOverlay').classList.remove('show');
 },

 updateStatus(message, type = 'loading') {
 const status = document.getElementById('apiStatus');
 status.innerHTML = message;
 status.className = `api-status ${type}`;
 }
 };

 // ë©”ì¸ ì•± í´ë˜ìŠ¤
 class CurrencyConverter {
 constructor() {
 this.state = new AppState();
 this.setupEventListeners();
 this.init();
 }

 async init() {
 try {
 utils.showLoading();
 await this.loadGoogleCharts();
 await this.drawMap();
 await this.fetchExchangeRates();
 this.startPeriodicUpdates();
 } catch (error) {
 console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
 utils.updateStatus('âš ï¸ ì´ˆê¸°í™” ì‹¤íŒ¨', 'error');
 } finally {
 utils.hideLoading();
 }
 }

 loadGoogleCharts() {
 return new Promise((resolve) => {
 google.charts.load('current', {
 packages: ['geochart'],
 mapsApiKey: 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
 });
 google.charts.setOnLoadCallback(resolve);
 });
 }

 async drawMap() {
 const data = google.visualization.arrayToDataTable([
 ['Country', 'Value'],
 ...Object.keys(COUNTRIES).map((code, i) => [code, i + 1])
 ]);

 const chart = new google.visualization.GeoChart(document.getElementById('geochart'));
 this.state.chart = chart;

 const options = {
 legend: 'none',
 colorAxis: {
 legend: { position: 'none' },
 colors: CHART_COLORS
 },
 backgroundColor: '#f8fafc',
 datalessRegionColor: '#f1f5f9',
 defaultColor: '#e2e8f0',
 width: '100%',
 height: '100%',
 tooltip: { trigger: 'none' },
 enableRegionInteractivity: true
 };

 chart.draw(data, options);

 // ì°¨íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
 google.visualization.events.addListener(chart, 'select', () => {
 const selection = chart.getSelection();
 if (selection.length > 0) {
 const country = Object.keys(COUNTRIES)[selection[0].row];
 if (country) this.focusCountry(country);
 }
 });

 // ì§€ë„ í˜¸ë²„ íš¨ê³¼ ì„¤ì • (ì§€ì—° ë¡œë”©)
 setTimeout(() => this.setupMapHoverEffects(), 1000);
 }

 setupMapHoverEffects() {
 const paths = document.querySelectorAll('#geochart path[fill]');
 paths.forEach((path, i) => {
 const country = Object.keys(COUNTRIES)[i];
 if (!country) return;

 path.style.cursor = 'pointer';
 path.addEventListener('mouseenter', () => this.handleMapHover(country));
 path.addEventListener('mouseleave', () => this.handleMapLeave());
 });
 }

 setupEventListeners() {
 document.querySelectorAll('.currency-input').forEach(el => {
 const country = el.dataset.country;
 const currency = el.dataset.currency;
 const input = el.querySelector('input');

 // ì…ë ¥ ì´ë²¤íŠ¸ - ì‹¤ì‹œê°„ ê³„ì‚°
 input.addEventListener('input', (e) => {
 const value = e.target.value;

 // ë¹ˆ ê°’ì´ë©´ ëª¨ë“  í•„ë“œ ì´ˆê¸°í™”
 if (!value || value.trim() === '') {
 this.clearOtherInputs(country);
 return;
 }

 // ìˆ«ì ì¶”ì¶œí•´ì„œ ê³„ì‚°
 const numValue = utils.parseNumber(value);
 if (numValue > 0) {
 this.convertCurrencies(country, numValue);
 }
 });

 // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸
 input.addEventListener('focus', () => {
 this.state.setActive(country);
 });

 // ë¸”ëŸ¬ ì´ë²¤íŠ¸
 input.addEventListener('blur', () => {
 this.state.clearActive();
 });

 // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
 el.addEventListener('mouseenter', () => this.handleInputHover(country));
 el.addEventListener('mouseleave', () => this.handleInputLeave());

 // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ - ìˆ«ìë§Œ ì…ë ¥ í—ˆìš©
 input.addEventListener('keydown', (e) => {
 if (e.key === 'Enter') {
 input.blur();
 return;
 }

 // í—ˆìš©í•  í‚¤ë“¤
 const allowedKeys = [
 'Backspace', 'Delete', 'Tab', 'Escape', 'Enter',
 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
 'Home', 'End'
 ];

 // Ctrl/Cmd ì¡°í•©í‚¤ í—ˆìš© (ë³µì‚¬, ë¶™ì—¬ë„£ê¸° ë“±)
 if (e.ctrlKey || e.metaKey) {
 return;
 }

 // í—ˆìš©ëœ í‚¤ë©´ í†µê³¼
 if (allowedKeys.includes(e.key)) {
 return;
 }

 // ìˆ«ì í‚¤ í—ˆìš©
 if (/^[0-9]$/.test(e.key)) {
 return;
 }

 // ì†Œìˆ˜ì  í—ˆìš© (í•˜ë‚˜ë§Œ)
 if (e.key === '.' && !input.value.includes('.')) {
 return;
 }

 // ê·¸ ì™¸ëŠ” ëª¨ë‘ ì°¨ë‹¨
 e.preventDefault();
 });
 });

 // ì „ì—­ í‚¤ë³´ë“œ ì´ë²¤íŠ¸
 document.addEventListener('keydown', (e) => {
 if (e.key === 'Escape') {
 this.clearAllInputs();
 }
 });
 }

 handleInputHover(country) {
 if (this.state.activeCountry === country) return;
 const el = document.querySelector(`.input-${country}`);
 el?.classList.add('map-hover');
 }

 handleInputLeave() {
 if (!this.state.activeCountry) {
 document.querySelectorAll('.currency-input').forEach(el => {
 el.classList.remove('map-hover');
 });
 }
 }

 handleMapHover(country) {
 this.handleInputHover(country);
 }

 handleMapLeave() {
 this.handleInputLeave();
 }

 focusCountry(country) {
 const input = document.querySelector(`.input-${country} input`);
 if (input) {
 input.focus();
 input.select();
 }
 }

 convertCurrencies(sourceCountry, sourceValue) {
 if (this.state.isConverting) return;
 this.state.isConverting = true;

 // ìœ íš¨í•˜ì§€ ì•Šì€ ê°’ì´ë©´ ë‹¤ë¥¸ í•„ë“œë“¤ ì´ˆê¸°í™”
 if (!sourceValue || sourceValue <= 0) {
 this.clearOtherInputs(sourceCountry);
 this.state.isConverting = false;
 return;
 }

 try {
 const sourceCurrency = COUNTRIES[sourceCountry].currency;
 const amountInKRW = sourceValue * exchangeRates[sourceCurrency];

 Object.entries(COUNTRIES).forEach(([country, info]) => {
 if (country === sourceCountry) return;

 const converted = amountInKRW / exchangeRates[info.currency];
 const input = document.querySelector(`.input-${country} input`);

 if (input && document.activeElement !== input) {
 if (converted > 0) {
 input.value = utils.formatCurrency(converted, info.currency);
 } else {
 input.value = '';
 }
 }
 });
 } catch (error) {
 console.error('í™˜ìœ¨ ë³€í™˜ ì˜¤ë¥˜:', error);
 utils.updateStatus('âš ï¸ í™˜ìœ¨ ë³€í™˜ ì‹¤íŒ¨', 'error');
 } finally {
 this.state.isConverting = false;
 }
 }

 clearOtherInputs(excludeCountry) {
 Object.keys(COUNTRIES).forEach(country => {
 if (country !== excludeCountry) {
 const input = document.querySelector(`.input-${country} input`);
 if (input) input.value = '';
 }
 });
 }

 clearAllInputs() {
 document.querySelectorAll('.currency-input input').forEach(input => {
 input.value = '';
 });
 this.state.clearActive();
 }

 async fetchExchangeRates() {
 utils.updateStatus('ğŸ”„ í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì¤‘...', 'loading');

 try {
 const controller = new AbortController();
 const timeoutId = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);

 const response = await fetch('https://api.exchangerate-api.com/v4/latest/KRW', {
 signal: controller.signal
 });

 clearTimeout(timeoutId);

 if (!response.ok) {
 throw new Error(`HTTP ${response.status}`);
 }

 const data = await response.json();

 if (data.rates) {
 // í™˜ìœ¨ ì—…ë°ì´íŠ¸
 Object.keys(exchangeRates).forEach(currency => {
 if (data.rates[currency]) {
 exchangeRates[currency] = 1 / data.rates[currency];
 }
 });

 this.state.lastUpdate = new Date();
 const timeString = this.state.lastUpdate.toLocaleTimeString('ko-KR');

 utils.updateStatus(
 `âœ… í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì™„ë£Œ<br><small>ì‹œê°„: ${timeString}</small>`,
 'success'
 );
 } else {
 throw new Error('ì‘ë‹µ ë°ì´í„° ì—†ìŒ');
 }
 } catch (error) {
 console.error('í™˜ìœ¨ API ì˜¤ë¥˜:', error);

 let message = 'âš ï¸ í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨<br><small>ê¸°ë³¸ í™˜ìœ¨ ì‚¬ìš©</small>';
 if (error.name === 'AbortError') {
 message = 'âš ï¸ ìš”ì²­ ì‹œê°„ ì´ˆê³¼<br><small>ê¸°ë³¸ í™˜ìœ¨ ì‚¬ìš©</small>';
 }

 utils.updateStatus(message, 'error');
 }
 }

 startPeriodicUpdates() {
 // ì£¼ê¸°ì  í™˜ìœ¨ ì—…ë°ì´íŠ¸
 setInterval(() => {
 this.fetchExchangeRates();
 }, CONFIG.UPDATE_INTERVAL);

 // í˜ì´ì§€ ê°€ì‹œì„± API ì‚¬ìš© - íƒ­ì´ í™œì„±í™”ë  ë•Œ ì—…ë°ì´íŠ¸
 document.addEventListener('visibilitychange', () => {
 if (!document.hidden && this.state.lastUpdate) {
 const timeSinceUpdate = Date.now() - this.state.lastUpdate.getTime();
 if (timeSinceUpdate > CONFIG.UPDATE_INTERVAL) {
 this.fetchExchangeRates();
 }
 }
 });
 }
 }

 // ì•± ì´ˆê¸°í™”
 document.addEventListener('DOMContentLoaded', () => {
 new CurrencyConverter();
 });

 // ì „ì—­ ì˜¤ë¥˜ ì²˜ë¦¬
 window.addEventListener('error', (e) => {
 console.error('ì „ì—­ ì˜¤ë¥˜:', e.error);
 utils.updateStatus('âš ï¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜ ë°œìƒ', 'error');
 });

 // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ì„ íƒì‚¬í•­)
 if ('serviceWorker' in navigator) {
 window.addEventListener('load', () => {
 // í–¥í›„ ì˜¤í”„ë¼ì¸ ì§€ì›ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì½”ë“œ
 console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ì§€ì› ê°€ëŠ¥');
 });
 }
 </script>
</body>
</html>
